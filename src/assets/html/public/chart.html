<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <style type="text/css">
        body,
        html,
        #main {
          height: 100%;
          width: 100%;
          background: #060613;
          touch-action: none;
        }
    </style>
    <title>ECharts</title>
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script> -->
    <script type="text/javascript"
      src="echarts.min.js">
    </script>
</head>

<body>
    <div id="main"></div>

    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById("main"));
        let u = navigator.userAgent
        let isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android terminal
        const boxRef = isAndroid ? document : window

        // Register events in HTML to receive data sent by RN and display it in HTML
        boxRef.addEventListener('message', function listener(RnData) {
            var options = JSON.parse(RnData.data).options
            var lange = JSON.parse(RnData.data)
            if (lange.type == 'fundsPie') {
                // Funds Flow Distribution Pie Chart
                options.legend[0].formatter = function (name) {
                    let data = options.series[0].data;
                    let total = data.reduce((sum, item) => sum + item.value, 0);
                    let item = data.find(i => i.name === name);
                    let showName=''
                    if(name==14||name==24){showName=lange.special}
                    if(name==13||name==23){showName=lange.big}
                    if(name==12||name==22){showName=lange.middle}
                    if(name==11||name==21){showName=lange.small}
                    
                    let percent = ((item.value / total) * 100).toFixed(1);
                    // return `${name}: ${item.value} (${percent}%)`;
                    return `${showName}: ${percent}%`;
                }
                options.legend[1].formatter = function (name) {
                    let data = options.series[0].data;
                    let total = data.reduce((sum, item) => sum + item.value, 0);
                    let item = data.find(i => i.name === name);
                    let showName=''
                    if(name==14||name==24){showName=lange.special}
                    if(name==13||name==23){showName=lange.big}
                    if(name==12||name==22){showName=lange.middle}
                    if(name==11||name==21){showName=lange.small}
                    
                    let percent = ((item.value / total) * 100).toFixed(1);
                    // return `${name}: ${item.value} (${percent}%)`;
                    return `${showName}: ${percent}%`;
                }
            } else if (JSON.parse(RnData.data).type == 'fundsBar') {
                // Fund flow bar chart
                options.tooltip.formatter = function (params) {
                    console.log(params)
                    let result = `<div "><b>${params[0].name}</b><br/>`;
                    params.forEach(item => {

                        result += `
                    ${item.value > 0 ? '淨流入' : '淨流出'}: <b>${item.value}</b><br/>`;
                    });
                    result += `</div>`;
                    return result;
                }
                options.series[0].itemStyle = {
                    color: function (params) {
                        return params.value >= 0 ? '#00BB83' : '#FF4D5C'; // Green represents positive values and red represents negative values
                    }
                }
                options.series[0].labelLayout = function (params) {
                    return {
                        y: params.text > 0 ? (params.rect.y - 12) : params.rect.y + params.rect.height,
                        align: 'center'
                    }
                }
            } else if (JSON.parse(RnData.data).type == 'businessPie') {
                // options.legend.formatter = function (name) {
                //     let data = options.series[0].data;
                //     let total = data.reduce((sum, item) => sum + item.value, 0);
                //     let item = data.find(i => i.name === name);
                //     let percent = ((item.value / total) * 100).toFixed(1);
                //     // return `${name}: ${item.value} (${percent}%)`;
                //     // return `${name}: ${percent}%`;
                //     return `{a|${name}}  {b|${percent}%}`;
                // }
                // Main Business Business Composition (Quarter)
            }else if (JSON.parse(RnData.data).type == 'financialBar') {
                // Financial Statements Data (Quarter)
            }
            else {
            }
            myChart.setOption(options);
        });
    </script>
</body>

</html>
